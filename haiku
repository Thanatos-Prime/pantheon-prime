#!/usr/bin/env python3
â€œâ€â€
Haiku Generator - Creates haikus from images or text descriptions
Requires: pip install openai pillow
â€œâ€â€

import os
import base64
from pathlib import Path
from openai import OpenAI

def encode_image(image_path):
â€œâ€â€œEncode image to base64 stringâ€â€â€
with open(image_path, â€œrbâ€) as image_file:
return base64.b64encode(image_file.read()).decode(â€˜utf-8â€™)

def generate_haiku_from_image(image_path, api_key):
â€œâ€â€œGenerate haiku from an image fileâ€â€â€
client = OpenAI(api_key=api_key)

```
# Encode the image
base64_image = encode_image(image_path)

# Get image type
extension = Path(image_path).suffix.lower()
mime_types = {
    '.jpg': 'image/jpeg',
    '.jpeg': 'image/jpeg',
    '.png': 'image/png',
    '.gif': 'image/gif',
    '.webp': 'image/webp'
}
mime_type = mime_types.get(extension, 'image/jpeg')

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "Analyze this image and create a haiku (5-7-5 syllable pattern) that captures its essence. Only respond with the haiku, nothing else."
                },
                {
                    "type": "image_url",
                    "image_url": {
                        "url": f"data:{mime_type};base64,{base64_image}"
                    }
                }
            ]
        }
    ],
    max_tokens=100
)

return response.choices[0].message.content.strip()
```

def generate_haiku_from_text(description, api_key):
â€œâ€â€œGenerate haiku from a text descriptionâ€â€â€
client = OpenAI(api_key=api_key)

```
response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {
            "role": "user",
            "content": f"Create a haiku (5-7-5 syllable pattern) about: {description}\n\nOnly respond with the haiku, nothing else."
        }
    ],
    max_tokens=100
)

return response.choices[0].message.content.strip()
```

def main():
â€œâ€â€œMain function to run the haiku generatorâ€â€â€
print(â€=â€ * 50)
print(â€œğŸ‹ HAIKU GENERATOR ğŸ‹â€)
print(â€=â€ * 50)

```
# Get API key from environment or user input
api_key = os.environ.get('OPENAI_API_KEY')
if not api_key:
    api_key = input("\nEnter your OpenAI API key: ").strip()

while True:
    print("\n" + "-" * 50)
    print("Choose an option:")
    print("1. Generate haiku from image")
    print("2. Generate haiku from text description")
    print("3. Exit")
    print("-" * 50)
    
    choice = input("\nYour choice (1/2/3): ").strip()
    
    if choice == '1':
        image_path = input("\nEnter the path to your image: ").strip()
        
        if not os.path.exists(image_path):
            print("âŒ Error: Image file not found!")
            continue
        
        print("\nğŸ¨ Analyzing image and generating haiku...")
        try:
            haiku = generate_haiku_from_image(image_path, api_key)
            print("\n" + "=" * 50)
            print("âœ¨ YOUR HAIKU âœ¨")
            print("=" * 50)
            print(haiku)
            print("=" * 50)
        except Exception as e:
            print(f"âŒ Error: {e}")
    
    elif choice == '2':
        description = input("\nEnter your description: ").strip()
        
        if not description:
            print("âŒ Error: Description cannot be empty!")
            continue
        
        print("\nâœï¸  Generating haiku...")
        try:
            haiku = generate_haiku_from_text(description, api_key)
            print("\n" + "=" * 50)
            print("âœ¨ YOUR HAIKU âœ¨")
            print("=" * 50)
            print(haiku)
            print("=" * 50)
        except Exception as e:
            print(f"âŒ Error: {e}")
    
    elif choice == '3':
        print("\nğŸ‘‹ Thank you for using Haiku Generator!")
        break
    
    else:
        print("âŒ Invalid choice. Please enter 1, 2, or 3.")
```

if **name** == â€œ**main**â€:
main()